<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Matter.js ç´„æŸç¤ºç¯„</title>
    <style>
        canvas {
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        // Matter.js æ¨¡çµ„åˆ¥å
        const Engine = Matter.Engine,
            Render = Matter.Render,
            Runner = Matter.Runner,
            Bodies = Matter.Bodies,
            Composite = Matter.Composite,
            Constraint = Matter.Constraint,
            MouseConstraint = Matter.MouseConstraint,
            Mouse = Matter.Mouse;

        // åœ¨ Matter.js æ¨¡çµ„åˆ¥åå¾Œæ·»åŠ é€™å€‹å‡½æ•¸
        function emojiToURL(emoji, size = 50) {
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            ctx.font = `${size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, size/2, size/2);
            return canvas.toDataURL();
        }

        // å‰µå»ºä¸€äº› emoji åœ–ç‰‡ URL
        const boxEmoji = emojiToURL('ğŸ“¦');
        const circleEmoji = emojiToURL('âš½');
        const bigCircleEmoji = emojiToURL('ğŸŒ•', 100);
        const smallCircleEmoji = emojiToURL('ğŸŒ‘', 50);
        const brickEmoji = emojiToURL('ğŸ§±');

        // å‰µå»ºå¼•æ“
        const engine = Engine.create();
        const world = engine.world;

        // å‰µå»ºæ¸²æŸ“å™¨
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: 1280,
                height: 960,
                wireframes: false
            }
        });

        // å‰µå»ºé‚Šç•Œ
        const boundaryOptions = {
            isStatic: true,
            render: {
                fillStyle: '#666'
            }
        };

        const ground = Bodies.rectangle(640, 950, 1290, 20, boundaryOptions);
        const leftWall = Bodies.rectangle(10, 480, 20, 960, boundaryOptions);
        const rightWall = Bodies.rectangle(1270, 480, 20, 960, boundaryOptions);
        const ceiling = Bodies.rectangle(640, 10, 1290, 20, boundaryOptions);

        // å½ˆæ€§ç´„æŸç¤ºä¾‹1ï¼šå…©å€‹æ–¹å½¢
        const box1 = Bodies.rectangle(300, 200, 50, 50, {
            render: {
                sprite: {
                    texture: boxEmoji,
                    xScale: 1,
                    yScale: 1
                }
            }
        });

        const box2 = Bodies.rectangle(400, 200, 50, 50, {
            render: {
                sprite: {
                    texture: boxEmoji,
                    xScale: 1,
                    yScale: 1
                }
            }
        });

        const elasticConstraint1 = Constraint.create({
            bodyA: box1,
            bodyB: box2,
            stiffness: 0.01,
            render: { lineWidth: 5 }
        });

        // å½ˆæ€§ç´„æŸç¤ºä¾‹2ï¼šåœ“çƒå’Œå›ºå®šé»
        const circle1 = Bodies.circle(500, 200, 20, {
            render: {
                sprite: {
                    texture: circleEmoji,
                    xScale: 0.8,
                    yScale: 0.8
                }
            }
        });

        const elasticConstraint2 = Constraint.create({
            pointA: { x: 500, y: 100 },
            bodyB: circle1,
            stiffness: 0.01,
            render: { lineWidth: 5 }
        });

        // å‰›æ€§ç´„æŸç¤ºä¾‹1ï¼šå…©å€‹ä¸åŒå¤§å°çš„åœ“
        const bigCircle = Bodies.circle(200, 300, 50, {
            render: {
                sprite: {
                    texture: bigCircleEmoji,
                    xScale: 1,
                    yScale: 1
                }
            }
        });

        const smallCircle = Bodies.circle(300, 300, 25, {
            render: {
                sprite: {
                    texture: smallCircleEmoji,
                    xScale: 1,
                    yScale: 1
                }
            }
        });

        const stiffConstraint1 = Constraint.create({
            bodyA: bigCircle,
            bodyB: smallCircle,
            length: 200,
            stiffness: 1,
            render: { lineWidth: 5 }
        });

        // å‰›æ€§ç´„æŸç¤ºä¾‹2ï¼šåœ“çƒå’Œå›ºå®šé»
        const circle2 = Bodies.circle(600, 300, 20, {
            render: {
                sprite: {
                    texture: circleEmoji,
                    xScale: 0.8,
                    yScale: 0.8
                }
            }
        });

        const stiffConstraint2 = Constraint.create({
            pointA: { x: 600, y: 200 },
            bodyB: circle2,
            stiffness: 1,
            render: { lineWidth: 5 }
        });

        // å‰µå»ºæ–¹å¡Šå¡”
        const stack = [];
        for (let i = 0; i < 10; i++) {
            stack.push(
                Bodies.rectangle(700, 550 - i * 30, 20, 30, {
                    render: {
                        sprite: {
                            texture: brickEmoji,
                            xScale: 0.4,
                            yScale: 0.6
                        }
                    }
                })
            );
        }

        // æ·»åŠ æ»‘é¼ æ§åˆ¶
        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                render: { visible: false }
            }
        });

        // å°‡æ‰€æœ‰ç‰©é«”æ·»åŠ åˆ°ä¸–ç•Œ
        Composite.add(world, [
            ground, leftWall, rightWall, ceiling,
            box1, box2, elasticConstraint1,
            circle1, elasticConstraint2,
            bigCircle, smallCircle, stiffConstraint1,
            circle2, stiffConstraint2,
            mouseConstraint,
            ...stack
        ]);

        // é‹è¡Œå¼•æ“å’Œæ¸²æŸ“å™¨
        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        // ä¿®æ­£æ»‘é¼ äº‹ä»¶
        render.canvas.addEventListener('mousewheel', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>
